#!/usr/bin/python
import sys
import os
import socket
import base64
import time
HOST = ''
PORT = 80
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
print 'sock created'
try:
	s.bind((HOST, PORT))
except socket.error, msg:
	print 'bind failed'
	sys.exit()
s.listen(1)
count = 0;
while 1:
	conn, addr = s.accept()
	count=count+1
	filename = str(count)  + "_" + addr[0] + "_" + time.strftime("%Y-%m-%d-%H:%M:%S") +  ".out"
	fo = open(filename,"w")
	print 'connection from' + addr[0]
	while 1:
		data = conn.recv(2048)
		fo.write(data)
		fo.flush()
		#print '%s' % data
		if data == "END00":
			print 'END OF SOCKET %i' % count
			conn.close()
			fo.close()
			break;
conn.close()
s.close()
